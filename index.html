<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="authoring-tool" content="Adobe_Animate_CC">
<title>ISEP Tycoon</title>
<link rel="icon" type="image/png" href="assets/favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

html, body {
	font-family: 'Inter', sans-serif;
	background-color: #f1f8e9; 
	color: #1a1a1a;
	overflow: hidden;
	height: 100%;
	width: 100%;
}

.page-wrapper {
	display: flex;
	flex-direction: column;
	height: 100vh;
	width: 100vw;
}

.header {
	flex: 0 0 auto;
	padding: 10px;
	display: flex;
	align-items: center;
	justify-content: center;
	background: #2E7D32;
	border-bottom: 4px solid #5D4037;
	box-shadow: 0 4px 10px rgba(0,0,0,0.2);
	z-index: 10;
}

.logo-img {
	height: 60px;
	filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.game-container {
	flex: 1 1 auto;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 10px;
	min-height: 0;
	overflow: hidden;
}

#animation_container {
	background-color: #fff;
	box-shadow: 0 10px 40px rgba(46, 125, 50, 0.4);
	border: 2px solid #5D4037;
	border-radius: 8px;
	overflow: hidden;
	position: relative;
	max-width: 100%;
	max-height: 100%;
	width: min(100%, calc((100vh - 120px) * 16 / 9));
	aspect-ratio: 16 / 9;
}

#canvas {
	display: block;
	width: 100%;
	height: 100%;
}

#dom_overlay_container {
	pointer-events: none;
	overflow: hidden;
	position: absolute;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
}

.footer {
	flex: 0 0 auto;
	padding: 8px 15px;
	display: flex;
	align-items: center;
	justify-content: center;
	background: #2E7D32;
	border-top: 4px solid #5D4037;
	font-size: 0.9rem;
	color: #ffffff;
	gap: 25px;
	flex-wrap: wrap;
	box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
	z-index: 10;
}

.footer-item {
	display: flex;
	align-items: center;
	gap: 6px;
	white-space: nowrap;
	font-weight: 600;
}

.rotate-message {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: #2E7D32;
	z-index: 9999;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	color: #fff;
	text-align: center;
	padding: 20px;
}

.rotate-icon {
	font-size: 4rem;
	margin-bottom: 20px;
	animation: rotate-hint 2s infinite ease-in-out;
}

@keyframes rotate-hint {
	0%, 100% { transform: rotate(0deg); }
	50% { transform: rotate(90deg); }
}

/* portrait mobile - show rotate hint */
@media (max-aspect-ratio: 1/1) and (max-width: 768px) {
	.rotate-message {
		display: flex;
	}
	
	.page-wrapper {
		display: none;
	}
}

/* landscape adjustments */
@media (min-aspect-ratio: 16/10) {
	.header {
		padding: 5px;
	}
	
	.logo-img {
		height: 50px;
	}
	
	.footer {
		padding: 5px 10px;
		font-size: 0.75rem;
	}
}
</style>

<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script src="isep_game.js?1767383137092"></script>
<script src="game_logic.js"></script>
<script src="car_logic.js"></script>
<script src="enemy_logic.js"></script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;

function init() {
	canvas = document.getElementById("canvas");
	anim_container = document.getElementById("animation_container");
	dom_overlay_container = document.getElementById("dom_overlay_container");
	var comp = AdobeAn.getComposition("C4EE32689A47AB45842BDB0D0E7EC980");
	var lib = comp.getLibrary();
	var loader = new createjs.LoadQueue(false);
	loader.addEventListener("fileload", function(evt){ handleFileLoad(evt, comp) });
	loader.addEventListener("complete", function(evt){ handleComplete(evt, comp) });
	loader.loadManifest(lib.properties.manifest);
}

function handleFileLoad(evt, comp) {
	var images = comp.getImages();	
	if (evt && (evt.item.type == "image")) { 
		images[evt.item.id] = evt.result; 
	}	
}

function handleComplete(evt, comp) {
	var lib = comp.getLibrary();
	var ss = comp.getSpriteSheet();
	var queue = evt.target;
	var ssMetadata = lib.ssMetadata;
	
	for(var i = 0; i < ssMetadata.length; i++) {
		ss[ssMetadata[i].name] = new createjs.SpriteSheet({
			"images": [queue.getResult(ssMetadata[i].name)], 
			"frames": ssMetadata[i].frames
		});
	}
	
	exportRoot = new lib.isep_game();
	window.exportRoot = exportRoot;
	window.lib = lib;
	
	stage = new lib.Stage(canvas);
	window.stage = stage;
	
	stage.enableMouseOver(20);
	
	fnStartAnimation = function() {
		stage.addChild(exportRoot);
		createjs.Ticker.framerate = lib.properties.fps;
		createjs.Ticker.addEventListener("tick", stage);
	}
	
	// keeps 16:9 ratio
	function resizeCanvas() {
		var container = document.querySelector('.game-container');
		var rect = container.getBoundingClientRect();
		var availableWidth = rect.width - 20;
		var availableHeight = rect.height - 20;
		
		var originalWidth = 1920;
		var originalHeight = 1080;
		var ratio = originalWidth / originalHeight;
		
		var targetWidth, targetHeight;
		
		if (availableWidth / availableHeight > ratio) {
			targetHeight = availableHeight;
			targetWidth = targetHeight * ratio;
		} else {
			targetWidth = availableWidth;
			targetHeight = targetWidth / ratio;
		}
		
		anim_container.style.width = Math.floor(targetWidth) + 'px';
		anim_container.style.height = Math.floor(targetHeight) + 'px';
		canvas.style.width = '100%';
		canvas.style.height = '100%';
	}
	
	resizeCanvas();
	window.addEventListener('resize', resizeCanvas);
	
	AdobeAn.compositionLoaded(lib.properties.id);
	fnStartAnimation();
	
	// wait for fonts before starting game
	if(window.initGame) {
		console.log("[HTML] Checking fonts...");
		if (document.fonts) {
			document.fonts.ready.then(function() {
				console.log("[HTML] Fonts ready, starting game...");
				initGame();
			});
		} else {
			setTimeout(initGame, 500);
		}
	}
}
</script>
</head>
<body onload="init();">
	<!-- font preload -->
	<div style="font-family: 'Bebas Neue'; opacity: 0; position: absolute; pointer-events: none;">preload</div>
	<div style="font-family: 'Inter'; opacity: 0; position: absolute; pointer-events: none;">preload</div>
	
	<!-- rotate hint for portrait -->
	<div class="rotate-message">
		<div class="rotate-icon">üì±</div>
		<h2>Roda o dispositivo</h2>
		<p>Este jogo funciona melhor em modo paisagem (horizontal)</p>
	</div>

	<div class="page-wrapper">
		<header class="header">
			<img src="assets/logo.png" alt="ISEP Logo" class="logo-img">
		</header>

		<main class="game-container">
			<div id="animation_container">
				<canvas id="canvas" width="1920" height="1080"></canvas>
				<div id="dom_overlay_container"></div>
			</div>
		</main>

		<footer class="footer">
			<div class="footer-item">
				<span>üè¢</span>
				<span>Clica para comprar edif√≠cios</span>
			</div>
			<div class="footer-item">
				<span>üå±</span>
				<span>Aumenta o teu n√≠vel de sustentabilidade</span>
			</div>
			<div class="footer-item">
				<span>üöó</span>
				<span>Clica no "E" e experimenta usar WASD ou as setas ;)</span>
			</div>
		</footer>
	</div>
</body>
</html>